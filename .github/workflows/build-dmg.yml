name: Build Test DMG

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build-dmg:
    runs-on: macos-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Create test script
        run: |
          mkdir dmg-contents
          echo '#!/bin/bash' > dmg-contents/test.sh
          echo 'echo "hello"' >> dmg-contents/test.sh
          chmod +x dmg-contents/test.sh
      
      - name: Install create-dmg
        run: brew install create-dmg
      
      - name: Build DMG
        run: |
          create-dmg \
            --volname "TestScript" \
            --window-pos 200 120 \
            --window-size 600 400 \
            --icon-size 100 \
            --icon "test.sh" 175 190 \
            --hide-extension "test.sh" \
            --custom-icon "test.sh" /System/Applications/Utilities/Terminal.app/Contents/Resources/Terminal.icns \
            --add-file "Terminal" /System/Applications/Utilities/Terminal.app 425 190 \
            "TestScript.dmg" \
            "dmg-contents/"
      
      - name: Upload DMG
        uses: actions/upload-artifact@v4
        with:
          name: test-dmg
          path: "*.dmg"
